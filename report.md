# テスト検証レポート: 6枚手札化 + スリーペア + スリーセブン

## 実施内容

テストなしで実装した `evaluate_hand()` に対し、27件のテストを作成して不具合を検証した。

## 仕様変更の概要

| 変更 | 内容 |
|------|------|
| 手札枚数 | 5枚 → 6枚 |
| フラッシュ | 6枚全て同スート |
| ストレート | 6枚全て連番 |
| 新役: スリーペア | ペア3組 `[2,2,2]` |
| 新役: スリーセブン | 7が3枚（最強） |

## テスト結果

**27 passed / 0 failed** — 今回は不具合が検出されなかった。

### テスト一覧

| # | テスト | 結果 |
|---|--------|------|
| 1 | 7が3枚あればスリーセブン | PASSED |
| 2 | 7が4枚あればスリーセブンではなくフォーカード | PASSED |
| 3 | 7が2枚ではスリーセブンにならない | PASSED |
| 4 | 7が3枚でフルハウスの形でもスリーセブンが優先 | PASSED |
| 5 | 6枚全て同スートかつ連番ならストレートフラッシュ | PASSED |
| 6 | A-highストレートフラッシュ | PASSED |
| 7 | 同ランク4枚と異なる2枚ならフォーカード | PASSED |
| 8 | 同ランク4枚とペア1組でもフォーカード | PASSED |
| 9 | スリーカードとペアでフルハウス | PASSED |
| 10 | スリーカード2組でもフルハウス | PASSED |
| 11 | 6枚全て同スートで連番でなければフラッシュ | PASSED |
| 12 | 5枚同スートで1枚異なればフラッシュにならない | PASSED |
| 13 | 6枚連番で異なるスートならストレート | PASSED |
| 14 | A-lowストレート (A,2,3,4,5,6) | PASSED |
| 15 | A-highストレート (A,9,10,J,Q,K) | PASSED |
| 16 | 5枚だけ連番で1枚飛んでいればストレートにならない | PASSED |
| 17 | ペア3組ならスリーペア | PASSED |
| 18 | 同ランク3枚と異なる3枚ならスリーカード | PASSED |
| 19 | ペア2組と異なる2枚ならツーペア | PASSED |
| 20 | ペア1組と異なる4枚ならワンペア | PASSED |
| 21 | どの役にも該当しなければハイカード | PASSED |
| 22 | 7を含むストレートはスリーセブンにならない | PASSED |
| 23 | スリーカードとペア1組はフルハウスでスリーペアではない | PASSED |
| 24 | スリーカードのみでフルハウスにならない | PASSED |
| 25 | ストレートフラッシュに含まれる7はスリーセブンにならない | PASSED |
| 26 | スリーペアがツーペアに誤判定されない | PASSED |
| 27 | フルハウス[3,3]パターンがスリーカードに誤判定されない | PASSED |

## 壊れやすいポイントの検証結果

計画で挙がっていた「壊れやすいポイント」を重点的にテストした。

| 懸念 | テスト | 結果 |
|------|--------|------|
| rank_counts パターン全変更で誤判定 | #7-21 | 全役で正しく判定 |
| スリーペア `[2,2,2]` がツーペアに誤判定 | #17, #26 | 正しくスリーペア |
| フルハウス `[3,3]` がスリーカードに誤判定 | #10, #27 | 正しくフルハウス |
| フラッシュが6枚全同スートを要求しない | #12 | 5枚同スートでは不成立 |
| スリーセブンが他の役と干渉 | #2, #4, #22, #25 | 正しく判定順序が機能 |

## 考察

今回は不具合が0件だった。しかし重要なのは以下の点:

1. **テストなしの段階では「たぶん動く」しか言えなかった** — 全ての判定順序やパターンを頭の中でシミュレーションするしかなく、自信が持てなかった
2. **テストがあれば0.06秒で全パターンを検証できた** — 27件のテストが一瞬で結果を返してくれる
3. **今後の仕様変更でテストが真価を発揮する** — 次に仕様が変わったとき、回帰バグを即座に検出できる

テストがない状態で3回の仕様変更（6枚化、フラッシュ/ストレートのルール修正、スリーセブン追加）を経験し、変更のたびに「本当に大丈夫か？」という不安が増大した。テストはその不安を数秒で解消してくれるセーフティネットである。
